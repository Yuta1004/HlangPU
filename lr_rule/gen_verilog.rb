# ; out a = b c if ( ) + - NUM $
$action_table = [
    #   ;  out  var    =   if    (    )   <<   >>    +    -  num    $
    [   0,   3,   4,   0,   0,   8,   0,   0,   0,   0,   0,   7,   0], #  0
    [   0,   3,   4,   0,   0,   8,   0,   0,   0,   0,   0,   7,  -1], #  1
    [  10,   0,   0,   0,   0,   0,   0,  11,  12,   0,   0,   0,   0], #  2
    [   0,   0,  14,   0,   0,   8,   0,   0,   0,   0,   0,   7,   0], #  3
    [ -13,   0,   0,  15,   0,   0,   0, -13, -13, -13, -13,   0,   0], #  4
    [  -8,   0,   0,   0,   0,   0,   0,  -8,  -8,  16,  17,   0,   0], #  5
    [ -11,   0,   0,   0,   0,   0,   0, -11, -11, -11, -11,   0,   0], #  6
    [ -12,   0,   0,   0,   0,   0,   0, -12, -12, -12, -12,   0,   0], #  7
    [   0,   0,  22,   0,   0,  23,   0,   0,   0,   0,   0,  21,   0], #  8
    [   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0, 999], #  9
    [   0,  -2,  -2,   0,   0,  -2,   0,   0,   0,   0,   0,  -2,  -2], # 10
    [   0,   0,  14,   0,   0,   8,   0,   0,   0,   0,   0,   7,   0], # 11
    [   0,   0,  14,   0,   0,   8,   0,   0,   0,   0,   0,   7,   0], # 12
    [  26,   0,   0,   0,   0,   0,   0,  11,  12,   0,   0,   0,   0], # 13
    [ -13,   0,   0,   0,   0,   0,   0, -13, -13, -13, -13,   0,   0], # 14
    [   0,   0,  31,   0,   0,  32,   0,   0,   0,   0,   0,  30,   0], # 15
    [   0,   0,  14,   0,   0,   8,   0,   0,   0,   0,   0,   7,   0], # 16
    [   0,   0,  14,   0,   0,   8,   0,   0,   0,   0,   0,   7,   0], # 17
    [   0,   0,   0,   0,   0,   0,  35,  36,  37,   0,   0,   0,   0], # 18
    [   0,   0,   0,   0,   0,   0,  -8,  -8,  -8,  38,  39,   0,   0], # 19
    [   0,   0,   0,   0,   0,   0, -11, -11, -11, -11, -11,   0,   0], # 20
    [   0,   0,   0,   0,   0,   0, -12, -12, -12, -12, -12,   0,   0], # 21
    [   0,   0,   0,   0,   0,   0, -13, -13, -13, -13, -13,   0,   0], # 22
    [   0,   0,  22,   0,   0,  23,   0,   0,   0,   0,   0,  21,   0], # 23
    [  -6,   0,   0,   0,   0,   0,   0,  -6,  -6,  16,  17,   0,   0], # 24
    [  -7,   0,   0,   0,   0,   0,   0,  -7,  -7,  16,  17,   0,   0], # 25
    [   0,  -3,  -3,   0,   0,  -3,   0,   0,   0,   0,   0,  -3,  -3], # 26
    [  41,   0,   0,   0,  42,   0,   0,  43,  44,   0,   0,   0,   0], # 27
    [  -8,   0,   0,   0,  -8,   0,   0,  -8,  -8,  45,  46,   0,   0], # 28
    [ -11,   0,   0,   0, -11,   0,   0, -11, -11, -11, -11,   0,   0], # 29
    [ -12,   0,   0,   0, -12,   0,   0, -12, -12, -12, -12,   0,   0], # 30
    [ -13,   0,   0,   0, -13,   0,   0, -13, -13, -13, -13,   0,   0], # 31
    [   0,   0,  22,   0,   0,  23,   0,   0,   0,   0,   0,  21,   0], # 32
    [  -9,   0,   0,   0,   0,   0,   0,  -9,  -9,  -9,  -9,   0,   0], # 33
    [ -10,   0,   0,   0,   0,   0,   0, -10, -10, -10, -10,   0,   0], # 34
    [ -14,   0,   0,   0,   0,   0,   0, -14, -14, -14, -14,   0,   0], # 35
    [   0,   0,  22,   0,   0,  23,   0,   0,   0,   0,   0,  21,   0], # 36
    [   0,   0,  22,   0,   0,  23,   0,   0,   0,   0,   0,  21,   0], # 37
    [   0,   0,  22,   0,   0,  23,   0,   0,   0,   0,   0,  21,   0], # 38
    [   0,   0,  22,   0,   0,  23,   0,   0,   0,   0,   0,  21,   0], # 39
    [   0,   0,   0,   0,   0,   0,  52,  36,  37,   0,   0,   0,   0], # 40
    [   0,  -4,  -4,   0,   0,  -4,   0,   0,   0,   0,   0,  -4,  -4], # 41
    [   0,   0,   0,   0,   0,  53,   0,   0,   0,   0,   0,   0,   0], # 42
    [   0,   0,  31,   0,   0,  32,   0,   0,   0,   0,   0,  30,   0], # 43
    [   0,   0,  31,   0,   0,  32,   0,   0,   0,   0,   0,  30,   0], # 44
    [   0,   0,  31,   0,   0,  32,   0,   0,   0,   0,   0,  30,   0], # 45
    [   0,   0,  31,   0,   0,  32,   0,   0,   0,   0,   0,  30,   0], # 46
    [   0,   0,   0,   0,   0,   0,  58,  36,  37,   0,   0,   0,   0], # 47
    [   0,   0,   0,   0,   0,   0,  -6,  -6,  -6,  38,  39,   0,   0], # 48
    [   0,   0,   0,   0,   0,   0,  -7,  -7,  -7,  38,  39,   0,   0], # 49
    [   0,   0,   0,   0,   0,   0,  -9,  -9,  -9,  -9,  -9,   0,   0], # 50
    [   0,   0,   0,   0,   0,   0, -10, -10, -10, -10, -10,   0,   0], # 51
    [   0,   0,   0,   0,   0,   0, -14, -14, -14, -14, -14,   0,   0], # 52
    [   0,   0,  22,   0,   0,  23,   0,   0,   0,   0,   0,  21,   0], # 53
    [  -6,   0,   0,   0,  -6,   0,   0,  -6,  -6,  45,  46,   0,   0], # 54
    [  -7,   0,   0,   0,  -7,   0,   0,  -7,  -7,  45,  46,   0,   0], # 55
    [  -9,   0,   0,   0,  -9,   0,   0,  -9,  -9,  -9,  -9,   0,   0], # 56
    [ -10,   0,   0,   0, -10,   0,   0, -10, -10, -10, -10,   0,   0], # 57
    [ -14,   0,   0,   0, -14,   0,   0, -14, -14, -14, -14,   0,   0], # 58
    [   0,   0,   0,   0,   0,   0,  60,  36,  37,   0,   0,   0,   0], # 59
    [  61,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0], # 60
    [   0,  -5,  -5,   0,   0,  -5,   0,   0,   0,   0,   0,  -5,  -5]  # 61
]

$reduce_table = [
    2,  #  0
    0,  #  1
    2,  #  2
    3,  #  3
    4,  #  4
    8,  #  5
    3,  #  6
    3,  #  7
    1,  #  8
    3,  #  9
    3,  # 10
    1,  # 11
    1,  # 12
    1,  # 13
    3   # 14
]

$goto_table = [
    # PROGRAM PROGRAM STMT STMT STMT STMT EXPR EXPR EXPR TERM TERM TERM FACT FACT FACT
    [       0,      0,   1,   1,   1,   1,   2,   2,   2,   5,   5,   5,   6,   6,   6],  #  0
    [       9,      9,   1,   1,   1,   1,   2,   2,   2,   5,   5,   5,   6,   6,   6],  #  1
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  #  2
    [       0,      0,   0,   0,   0,   0,  13,  13,  13,   5,   5,   5,   6,   6,   6],  #  3
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  #  4
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  #  5
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  #  6
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  #  7
    [       0,      0,   0,   0,   0,   0,  18,  18,  18,  19,  19,  19,  20,  20,  20],  #  8
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  #  9
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 10
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,  24,  24,  24,   6,   6,   6],  # 11
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,  25,  25,  25,   6,   6,   6],  # 12
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 13
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 14
    [       0,      0,   0,   0,   0,   0,  27,  27,  27,  28,  28,  28,  29,  29,  29],  # 15
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  33,  33,  33],  # 16
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  34,  34,  34],  # 17
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 18
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 19
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 20
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 21
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 22
    [       0,      0,   0,   0,   0,   0,  40,  40,  40,  19,  19,  19,  20,  20,  20],  # 23
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 24
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 25
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 26
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 27
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 28
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 29
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 30
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 31
    [       0,      0,   0,   0,   0,   0,  47,  47,  47,  19,  19,  19,  20,  20,  20],  # 32
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 33
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 34
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 35
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,  48,  48,  48,  20,  20,  20],  # 36
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,  49,  49,  49,  20,  20,  20],  # 37
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  50,  50,  50],  # 38
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  51,  51,  51],  # 39
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 40
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 41
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 42
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,  54,  54,  54,  29,  29,  29],  # 43
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,  55,  55,  55,  29,  29,  29],  # 44
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  56,  56,  56],  # 45
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  57,  57,  57],  # 46
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 47
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 48
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 49
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 50
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 51
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 52
    [       0,      0,   0,   0,   0,   0,  59,  59,  59,  19,  19,  19,  20,  20,  20],  # 53
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 54
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 55
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 56
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 57
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 58
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 59
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 60
    [       0,      0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],  # 61
]

def gen_action_table
    def convert (val)
        if val == 999
            sprintf("10'h3_00")
        elsif val > 0
            sprintf("10'h1_%02x", val)
        elsif val < 0
            sprintf("10'h2_%02x", -val)
        else
            sprintf("10'h0_00")
        end
    end

    rows = $action_table.length
    cols = $action_table[0].length
    fixed_cols = 1 << Math.log2($action_table[0].length).ceil

    for r in 0..(rows-1) do
        for c in 0..(cols-1) do
            print sprintf("action_table[%d] = %s; ", r * fixed_cols + c, convert($action_table[r][c]))
        end
        for c in cols..(fixed_cols-1) do
            print sprintf("action_table[%d] = 10'h0_00; ", r * fixed_cols + c)
        end
        puts ""
    end
end

def gen_reduce_table
    rows = $reduce_table.length
    for r in 0..(rows-1) do
        puts sprintf("reduce_table[%d] = 8'h%02x;", r, $reduce_table[r])
    end
end

def gen_goto_table
    rows = $goto_table.length
    cols = $goto_table[0].length
    fixed_cols = 1 << Math.log2($action_table[0].length).ceil

    for r in 0..(rows-1) do
        for c in 0..(cols-1) do
            print sprintf("goto_table[%d] = 8'h%02x; ", r * fixed_cols + c, $goto_table[r][c])
        end
        for c in cols..(fixed_cols-1) do
            print sprintf("goto_table[%d] = 8'h00; ", r * fixed_cols + c)
        end
        puts ""
    end
end

# gen_action_table
# gen_reduce_table
gen_goto_table
